# JWT 認証 について説明できる

認証（ログイン）は多くのウェブアプリケーションで必要とされる機能です。

認証を実現するのに一般的に使用されるのが、JWT 認証です。

## 1. 認証 とは

認証とは何か、プログラミング初心者にわかるように説明してください。

- システムがユーザーの身元を確認するためのプロセスのことを指す。
- ユーザーがシステムに対して「私は〇〇である」と主張したとき、その主張が正しいかどうかを確認するために行う。
- 認証が成功すると、ユーザーはシステム内の特定のリソースやサービスにアクセスできるようになる。
- 認証と似て異なる概念として「認可」があるが、認証が「あなたは本当にあなたですか？」という問いに答えるのに対し、認可は「あなたはこの操作を行う権限がありますか？」という問いに答える。つまり、認証がユーザーの身元を確認するのに対し、認可はそのユーザーが何を許可されているかを決定する。

## 2. JWT とは

JWT とは何か、プログラミング初心者にわかるように説明してください。
- JSON Web Tokensの略
- 情報を安全に伝達するためのコンパクトで自己完結型の方法で、Webアプリでユーザー認証や情報交換に広く利用されている。
- HTTPヘッダーの「Authorization」フィールドを通じて送信される。これにより、ユーザーが一度ログインすれば、その後のリクエストはJWTを使用して自動的に認証される。
- 主に「Header」「Payload」「Signature」３つの部分で構成されている。
1. 「Header」:これはJWTのタイプと、使用するハッシュアルゴリズム（通常はHMAC SHA256またはRSA）を定義
2. 「Payload」:これはトークンに含まれるクレーム（情報の断片）を含む。クレームはユーザーに関連するデータや、トークンに関連するメタデータを含むことがある。
3. 「Signature」:これはヘッダーとペイロード、そして秘密キーを使用して生成される。メッセージが変更されていないこと、そしてJWTが信頼できる発信者からのものであることを検証する。


## 3. JWT 認証の流れ

JWT を用いた認証の流れ（どのような流れで認証が行われるのか）を説明してください。
1. ユーザーがログイン：ユーザーがIDとパスワードを使用してログイン、この情報はサーバーに送信
2. サーバーが認証を行う：サーバーはデータベースを確認して、送信されたIDとパスワードが正しいか確認
3. JWTの生成：ユーザーの認証が成功したら、サーバーはJWTを生成する。このJWTには、一般的にユーザーIDやログイン日時、有効期限などの情報（ペイロード）が含まれる。また、それらの情報とともに、秘密キー（サーバーだけが知っている）を用いて署名が行われ、これによりJWTの改ざんを防止する。
4. JWTの送信：サーバーは生成したJWTをユーザーに返す。ユーザーはこのJWTをブラウザやアプリに保存、多くの場合、JWTはHTTPレスポンスのボディ、もしくはクッキーとして送られる。
5. JWTの使用：これ以降、ユーザーが認証が必要なリクエスト（プロフィール情報更新など）を行う際、そのリクエストにJWTを含めてサーバーに送る。一般的にHTTPリクエストの「Authorization」ヘッダーにJWTを付けて送る。
6. JWTの検証：サーバーは受け取ったJWTの署名を検証する。署名の検証はJWTの生成時に使用した秘密キーを用いて行う
7. リクエストの処理：JWTの署名が正しく、有効期限内であることが確認できたら、サーバーはリクエストを処理する。

## 4. JWT 認証のメリット・デメリット

JWT を用いた認証のメリット、デメリットを挙げてください。

- メリット
1. ステートレス：JWTは自己完結型である。つまり、JWTはユーザーの認証状態をエンコードしたトークンを持っており、これによりサーバーはセッション情報を保持する必要がなくなる。このため、サーバーは負荷が減り、スケーラビリティ（大規模化に対応する能力）が向上する。
2. 分散化されたシステムで利用：JWTはどのシステムでも解釈できるため、分散化されたシステムやマイクロサービス間での認証情報の共有に役立つ
3. モバイルアプリケーション対応：クッキーを使わないため、モバイルアプリとも互換性がある。
4. クロスドメイン・クロスオリジンのリクエスト対応：クッキーを使用する従来のセッションベースの認証では困難な場合が多い。

- デメリット
1. トークンの盗難：トークンが盗まれた場合、盗んだ者はトークンの有効期限が切れるまでの間、そのトークンを使用してシステムにアクセスすることが可能になってしまう。そのため、トークンの保存と送信には慎重な取り扱いが必要
2. トークンのサイズ：JWTは従来のセッションIDに比べてサイズが大きいため、それをヘッダーに含めて送信すると、ネットワークの負荷が増加する可能性あり
3. ペイロードの暗号化：JWTのペイロード部分は基本的に暗号化されていないため、センシティブな情報は含めないようにする。
4. 即時の無効化が困難：一度JWTが発行されると、その有効期限が切れるまで無効化することが困難。
